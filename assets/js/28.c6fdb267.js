(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{500:function(s,t,a){"use strict";a.r(t);var n=a(12),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"rails启动分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rails启动分析"}},[s._v("#")]),s._v(" rails启动分析")]),s._v(" "),a("p",[s._v("对于像rails这样的庞然大物，采用逐个阅读文件的方式学习显然是不现实的, 但是代码是死的，运行起来的程序是活的，所以跟随程序的运行去动态的分析能更快地抓住主要的脉络, 如果遇到难懂的代码，就打个断点，查看下环境binding，而且现在的调试工具（比如"),a("code",[s._v("byebug")]),s._v("）支持在隔离的环境中测试运行。")]),s._v(" "),a("p",[s._v("读rails源码找方法是基本操作：一般先找"),a("code",[s._v("def")]),s._v("定义，如没有则找"),a("code",[s._v("attr_reader/attr_accessor")]),s._v("，再没有找"),a("code",[s._v("delegate")]),s._v("，按这三步依次在祖先链上查找。")]),s._v(" "),a("p",[s._v("我们从命令行敲下"),a("code",[s._v("rails server")]),s._v("开始（这里假设你已经用"),a("code",[s._v("rails new <app_name>")]),s._v("生成了一个项目），分析rails的启动流程。")]),s._v(" "),a("p",[s._v("首先奉上辛苦整理的调用栈。大体的流程为：执行可执行文件（rails）-> 根据命令行参数（server）执行对应的perform函数 -> 找到web server(puma) -> 构建app -> 启动server")]),s._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/bin/rails")]),s._v("\nload "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Gem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("activate_bin_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'railties'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rails'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/exe/rails")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rails/cli"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/cli.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rails/app_loader"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AppLoader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exec_app\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/app_loader.rb")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exec_app")])]),s._v("\n      exec "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RUBY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" exe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ARGV")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/Desktop/learn_rails/bin/rails")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("APP_PATH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("expand_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../config/application'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __dir__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nrequire_relative "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../config/boot'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/Desktop/learn_rails/config/boot.rb")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BUNDLE_GEMFILE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("expand_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../Gemfile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __dir__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bundler/setup'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set up gems listed in the Gemfile.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bootsnap/setup'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Speed up boot time by caching expensive operations.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rails/commands'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/commands.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rails/command"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("invoke command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ARGV")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/command.rb")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("full_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("perform"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("command_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/commands/server/server_command.rb")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("perform")])]),s._v("\n        extract_environment_option_from_argument\n        set_application_directory"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n        prepare_restart\n        "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server_options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tap "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Require application after server sets environment to propagate")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the --environment option.")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("APP_PATH")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("chdir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("application"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("serveable"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("serveable")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# :nodoc:")]),s._v("\n                server\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/rack-2.2.2/lib/rack/server.rb")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")])]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@_server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@_server")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@_server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("default\n                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/rack-2.2.2/lib/rack/handler.rb")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("default")])]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Guess.")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PHP_FCGI_CHILDREN"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FastCGI")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elsif")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REQUEST_METHOD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CGI")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elsif")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RACK_HANDLER"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RACK_HANDLER"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n                                pick "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SERVER_NAMES")]),s._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pick")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                  server_names "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                  server_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("each")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("server_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to_s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" server\n                                            server "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to_s\n\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" server\n                                              load_error "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" try_require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rack/handler'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("try_require")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" const_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                    file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" const_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gsub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[s._v("/^[A-Z]+/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("pre"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" pre"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("downcase "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n                                                      gsub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[s._v("/[A-Z]+[^A-Z]/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'_\\&'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("downcase\n\n                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/puma-4.3.5/lib/rack/handler/puma.rb")]),s._v("\n                                                        register "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":puma")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Puma")]),s._v("\n                                                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/rack-2.2.2/lib/rack/handler.rb")]),s._v("\n                                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("register")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" klass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@handlers")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                                                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to_s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" klass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to_s\n                                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("nil")]),s._v("\n                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LoadError")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" error\n                                                    error\n                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" klass "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                                              const_get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("klass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n                                              const_get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NameError")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" name_error\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" load_error "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" name_error\n                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LoadError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NameError")]),s._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LoadError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Couldn't find handler for: "),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token delimiter tag"}},[s._v("#{")]),s._v("server_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("', '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token delimiter tag"}},[s._v("}")])]),s._v('."')]),s._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# We already speak FastCGI")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@ignore_options")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":Port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to_s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Rack::Handler::FastCGI'")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n                      "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@_server")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LoadError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NameError")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n            print_boot_information"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("served_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            after_stop_callback "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" say "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exiting"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":daemon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("after_stop_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("after_stop_callback "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                  trap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" exit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                  create_tmp_directories\n                  setup_dev_caching\n                  log_to_stdout "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":log_stdout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log_to_stdout")])]),s._v("\n                        wrapped_app "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# touch the app so the logger is set up")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/rack-2.2.2/lib/rack/server.rb")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wrapped_app")])]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@wrapped_app")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" build_app app\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("app")])]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@app")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":builder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" build_app_from_string "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build_app_and_options_from_config\n                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("build_app_and_options_from_config")])]),s._v("\n                                    app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Builder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" opt_parser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/rack-2.2.2/lib/rack/builder.rb")]),s._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("parse_file")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" opts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("load_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" opts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("load_file")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" opts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new_from_string cfgfile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" path\n                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("new_from_string")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("builder_script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(rackup)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# We want to build a variant of TOPLEVEL_BINDING with self as a Rack::Builder instance.")]),s._v("\n                                                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# We cannot use instance_eval(String) as that would resolve constants differently.")]),s._v("\n                                                      binding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" builder "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TOPLEVEL_BINDING")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("eval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Rack::Builder.new.instance_eval { [binding, self] }'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                      eval builder_script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" binding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" file\n                                                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/Desktop/learn_rails/config.ru")]),s._v("\n                                                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This file is used by Rack-based servers to start the application.")]),s._v("\n                                                          require_relative "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'config/environment'")]),s._v("\n                                                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/Desktop/learn_rails/config/environment.rb")]),s._v("\n                                                              require_relative "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application'")]),s._v("\n                                                                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/Desktop/learn_rails/config/application.rb")]),s._v("\n                                                                  require_relative "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'boot'")]),s._v("\n                                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rails/all'")]),s._v("\n                                                                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/all.rb")]),s._v("\n                                                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rails"')]),s._v("\n                                                                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails.rb")]),s._v("\n                                                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rails/appliction'")]),s._v("\n\n                                                                      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("%w(\n                                                                        active_record/railtie\n                                                                        active_storage/engine\n                                                                        action_controller/railtie\n                                                                        action_view/railtie\n                                                                        action_mailer/railtie\n                                                                        active_job/railtie\n                                                                        action_cable/engine\n                                                                        action_mailbox/engine\n                                                                        action_text/engine\n                                                                        rails/test_unit/railtie\n                                                                        sprockets/railtie\n                                                                      )")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("each")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("railtie"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n                                                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n                                                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" railtie\n                                                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LoadError")]),s._v("\n                                                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                                  \n                                                                  "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Bundler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("groups"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("module")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LearnRails")]),s._v("\n                                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Application")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Application")]),s._v("\n                                                                      config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("load_defaults "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v("\n                                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                              "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("application"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initialize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n                                                          run "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("application\n                                                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/rack-2.2.2/lib/rack/builder.rb")]),s._v("\n                                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                                "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@run")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" app\n                                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                      builder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to_app\n                                                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Return the Rack application generated by this instance.")]),s._v("\n                                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("to_app")])]),s._v("\n                                                            app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@map")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" generate_map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@run")]),s._v("\n                                                            fail "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"missing run or map statement"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" app\n                                                            app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("freeze "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@freeze_app")]),s._v("\n                                                            app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reverse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("freeze "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@freeze_app")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                                                            "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@warmup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("call"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@warmup")]),s._v("\n                                                            app\n                                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("build_app")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                              middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reverse_each "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("middleware"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n                                middleware "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("call"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("respond_to"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("next")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" middleware\n                                klass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" middleware\n                                app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" klass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                              app\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                        console "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ActiveSupport")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Logger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STDOUT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("formatter "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("formatter\n                        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("level "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("level\n\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ActiveSupport")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Logger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger_outputs_to"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STDOUT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                          "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ActiveSupport")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Logger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("broadcast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/rack-2.2.2/lib/rack/server.rb")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")])]),s._v("\n                        server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wrapped_app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")])]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@_server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wrapped_app")])]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@wrapped_app")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" build_app app\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/puma-4.3.5/lib/rack/handler/puma.rb")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                              conf   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                              events "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":Silent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Puma")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Events")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("strings "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Puma")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Events")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stdio\n                              launcher "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Puma")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Launcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":events")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" events"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),s._v(" launcher "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" block_given"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n                                launcher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run\n                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/puma-4.3.5/lib/puma/launcher.rb")]),s._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Run the server. This blocks until the server is stopped")]),s._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")])]),s._v("\n                                      setup_signals\n                                      set_process_title\n                                      "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@runner")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run\n                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initialize")])]),s._v("\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" clustered"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n                                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":logger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@events")]),s._v("\n                                      \n                                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@runner")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Cluster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@events")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n                                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@runner")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Single")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@events")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/puma-4.3.5/lib/puma/single.rb")]),s._v("\n                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")])]),s._v("\n                                            "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" server "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" start_server\n                                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start_server")])]),s._v("\n                                                  min_t "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":min_threads")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                                                  max_t "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":max_threads")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                                            \n                                                  server "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Puma")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@launcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("events"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@options")]),s._v("\n                                                  server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("min_threads "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" min_t\n                                                  server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("max_threads "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" max_t\n                                                  server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inherit_binder "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@launcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("binder\n                                                  server\n                                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                            server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join\n                                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/puma-4.3.5/lib/puma/server.rb")]),s._v("\n                                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("background"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" background\n                                                    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@thread")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n                                                      "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Puma")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("set_thread_name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server"')]),s._v("\n                                                      handle_servers\n                                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle_servers")])]),s._v("\n                                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":run")]),s._v("\n                                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n                                                                ios "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("IO")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("select sockets\n                                                                ios"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("each")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("sock"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n                                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" sock "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" check\n                                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" handle_check\n                                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n                                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n                                                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" io "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("accept_nonblock\n                                                                        client "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@binder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" remote_addr_value\n                                                                          client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("peerip "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" remote_addr_value\n                                                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elsif")]),s._v(" remote_addr_header\n                                                                          client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("remote_addr_header "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" remote_addr_header\n                                                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                    \n                                                                        pool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" client\n                                                                        busy_threads "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wait_until_not_full\n                                                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" busy_threads "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                                                                          "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":out_of_band")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("each")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":out_of_band")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                                                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SystemCallError")]),s._v("\n                                                                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nothing")]),s._v("\n                                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Errno")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ECONNABORTED")]),s._v("\n                                                                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# client closed the socket even before accept")]),s._v("\n                                                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n                                                                        io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close\n                                                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v("\n                                                                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("purge_interrupt_queue "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("respond_to"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":purge_interrupt_queue")]),s._v("\n                                                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Object")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" e\n                                                                "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@events")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("unknown_error "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Listen loop"')]),s._v("\n                                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                            "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@events")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fire "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@status")]),s._v("\n                                                            graceful_shutdown "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":stop")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":restart")]),s._v("\n                                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" queue_requests\n                                                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@reactor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clear"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n                                                              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@reactor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shutdown\n                                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@thread")]),s._v("\n                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n                                                    handle_servers\n                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@status")]),s._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("when")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":halt")]),s._v("\n                                        log "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* Stopping immediately!"')]),s._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("when")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":stop")]),s._v("\n                                        graceful_stop\n                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("when")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":restart")]),s._v("\n                                        log "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* Restarting..."')]),s._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("replace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("previous_env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@runner")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("before_restart\n                                        restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("when")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":exit")]),s._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nothing")]),s._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@binder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close_unix_paths\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rescue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Interrupt")]),s._v("\n                                puts "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* Gracefully stopping, waiting for requests to finish"')]),s._v("\n                                launcher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stop\n                                puts "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* Goodbye!"')]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ensure")]),s._v("\n                  after_stop_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("call "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" after_stop_callback\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n            say rack_server_suggestion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("using"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])])]),a("p",[s._v("如果你能跟随调用栈走到Rails.application.initialize!这一步，那么恭喜你不畏长途跋涉，终于到达了rails启动主体内容的入口。")]),s._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/application.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initialize")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("group "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#:nodoc:")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Application has been already initialized."')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@initialized")]),s._v("\n  run_initializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/initializable.rb")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run_initializers")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("group "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" instance_variable_defined"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@ran")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        initializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tsort_each "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("initializer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n          initializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" initializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("belongs_to"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@ran")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@initialized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/application.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initializers")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Bootstrap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initializers_for"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n  railties_initializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Finisher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initializers_for"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/initializable.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("instance_exec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/initializable.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initializer")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" opts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("blk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ArgumentError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A block must be passed when defining an initializer"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" blk\n  opts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":after")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" initializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("last"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" initializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("empty"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" initializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("find "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" opts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":before")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  initializers "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Initializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" opts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("blk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])])]),a("p",[s._v("initializers方法收集了所有的启动对象，依次调用每个对象的run方法完成启动，通过调用initializer注册启动对象。主要有三类启动对象")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("Booststrap（以下列出注册的各启动对象的name）")]),s._v(" "),a("ul",[a("li",[s._v("load_environment_hook")]),s._v(" "),a("li",[s._v("load_active_support")]),s._v(" "),a("li",[s._v("set_eager_load")]),s._v(" "),a("li",[s._v("initialize_logger")]),s._v(" "),a("li",[s._v("initialize_cache")]),s._v(" "),a("li",[s._v("initialize_dependency_machanism")]),s._v(" "),a("li",[s._v("bootstrap_hook")]),s._v(" "),a("li",[s._v("set_secrets_root")])])]),s._v(" "),a("li",[a("p",[s._v("railties")]),s._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/engine/railties.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("module")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Engine")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Railtie")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Railties")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initialize")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@_all")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Railtie")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subclasses"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Engine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("subclasses"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])])]),a("p",[s._v("可以看到这一类启动对象包括了所有继承Railtie或继承Engine的类的实例")])]),s._v(" "),a("li",[a("p",[s._v("Finisher")]),s._v(" "),a("ul",[a("li",[s._v("add_generator_templates")]),s._v(" "),a("li",[s._v("ensure_autoload_once_paths_as_subset")]),s._v(" "),a("li",[s._v("warn_if_autoloaded")]),s._v(" "),a("li",[s._v("let_zeitwerk_take_overa")]),s._v(" "),a("li",[s._v("add_builtin_route")]),s._v(" "),a("li",[s._v("setup_default_session_store")]),s._v(" "),a("li",[s._v("build_middleware_stack")]),s._v(" "),a("li",[s._v("define_main_app_helper")]),s._v(" "),a("li",[s._v("add_to_prepare_blocks")]),s._v(" "),a("li",[s._v("run_prepare_callbacks")]),s._v(" "),a("li",[s._v("eager_load!")]),s._v(" "),a("li",[s._v("finisher_hook")]),s._v(" "),a("li",[s._v("configure_executor_for_concurrency")]),s._v(" "),a("li",[s._v("set_routes_reloader_hook")]),s._v(" "),a("li",[s._v("set_clear_dependencies_hook")]),s._v(" "),a("li",[s._v("disable_dependency_loading")])]),s._v(" "),a("p",[s._v("这里重点讲一下中间件的加载。")]),s._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/rack-2.2.2/lib/rack/builder.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("to_app")])]),s._v("\n  app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@map")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" generate_map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@run")]),s._v("\n  fail "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"missing run or map statement"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" app\n  app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("freeze "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@freeze_app")]),s._v("\n  app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reverse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("freeze "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@freeze_app")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@warmup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("call"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@warmup")]),s._v("\n  app\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/rack-2.2.2/lib/rack/server.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("build_app")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reverse_each "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("middleware"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    middleware "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("call"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("respond_to"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("next")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unless")]),s._v(" middleware\n    klass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" middleware\n    app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" klass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n  app\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])])]),a("p",[s._v("首先构建app的时候调用了 to_app 方法，Rack::Builder#use是rack应用注册中间件的方法，但是rails没有用，打断点查看@use为[]。")]),s._v(" "),a("p",[s._v("wrap_app调用了build_app, 注册了rack在不同环境下默认的中间件")]),s._v(" "),a("p",[s._v("rails 加载中间件的方式是通过启动对象build_middleware_stack，Rails::Application里面有这么一句 alias :build_middleware_stack :app")]),s._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/engine.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("app")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@app")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@app_build_lock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("synchronize "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@app")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n      stack "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" default_middleware_stack\n      config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("middleware "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" build_middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("merge_into"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("endpoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])])]),a("p",[s._v("在执行build_middleware_stack之前，config.middleware是Rails::Configuration::MiddlewareStackProxy, merge_into后变成了ActionDispatch::MiddlewareStack")])])]),s._v(" "),a("p",[s._v("源代码里扒出来的启动过程注释")]),s._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /Users/yanjinkai/.rvm/gems/ruby-2.7.0/gems/railties-6.0.3.1/lib/rails/application.rb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# == Booting process")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The application is also responsible for setting up and executing the booting")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# process. From the moment you require "config/application.rb" in your app,')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the booting process goes like this:")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#   1)  require "config/boot.rb" to setup load paths')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   2)  require railties and engines")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#   3)  Define Rails.application as "class MyApp::Application < Rails::Application"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   4)  Run config.before_configuration callbacks")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   5)  Load config/environments/ENV.rb")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   6)  Run config.before_initialize callbacks")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   7)  Run Railtie#initializer defined by railties, engines and application.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       One by one, each engine sets up its load paths, routes and runs its config/initializers/* files.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   8)  Custom Railtie#initializers added by railties, engines and applications are executed")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   9)  Build the middleware stack and run to_prepare callbacks")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   10) Run config.before_eager_load and eager_load! if eager_load is true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   11) Run config.after_initialize callbacks")]),s._v("\n")])])]),a("p",[s._v("参考: "),a("a",{attrs:{href:"https://guides.rubyonrails.org/initialization.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://guides.rubyonrails.org/initialization.html"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);