(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{498:function(s,t,a){"use strict";a.r(t);var e=a(12),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"pg查询优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pg查询优化"}},[s._v("#")]),s._v(" pg查询优化")]),s._v(" "),a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),a("p",[s._v("上次谈到数据库压测证明线上并发连接压力导致数据库变慢了，这次谈谈怎么优化的。主要涉及到的查询是")]),s._v(" "),a("p",[a("code",[s._v("select * from tables where tables.columns = value limit 100 offset 0;")])]),s._v(" "),a("p",[s._v("数据库的优化可以从几个方面进行：")]),s._v(" "),a("ul",[a("li",[s._v("提升服务器硬件配置")]),s._v(" "),a("li",[s._v("更改数据库配置")]),s._v(" "),a("li",[s._v("建立合适的索引，代码配合使查询用到索引")])]),s._v(" "),a("p",[s._v("这次主要是讲第三种")]),s._v(" "),a("h2",{attrs:{id:"index-only-scan"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#index-only-scan"}},[s._v("#")]),s._v(" index-only scan")]),s._v(" "),a("p",[s._v("index-only scan是指在索引中就能查到所需的数据，不需要查表，index-only scan要求select,where,order出现的字段都出现在索引里。所以建立组合索引")]),s._v(" "),a("p",[a("code",[s._v("create index index_tabels_on_fields1_and_fields_2 on schema.tables (field1, field2) [using btree] include (field3, field4)")])]),s._v(" "),a("p",[s._v("pg 默认使用btree索引所以可以省略, filed1, field2放到key上用于定位索引，field3、field4放到include里（只存在于叶子节点里），这样查询种如果只涉及着四个字段就可以使用index-only scan了。")]),s._v(" "),a("p",[s._v("但是我们的代码里要拿到所有的数据，所以查询做了变通")]),s._v(" "),a("p",[a("code",[s._v("select * from tables where tables.id in (select id from tables where tables.field1 = value limit 100 offset 0)")])]),s._v(" "),a("p",[s._v("这样子查询就可以使用index-only scan，分页后拿到第一页的id，再通过主键索引查到第一页的数据")]),s._v(" "),a("p",[s._v("以上基本上大部分查询慢的问题就解决了")]),s._v(" "),a("h2",{attrs:{id:"elastic-search"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elastic-search"}},[s._v("#")]),s._v(" Elastic Search")]),s._v(" "),a("p",[s._v("有个需要模糊查询的文本字段，因为产品层面没做字数限制部分数据太大建不了索引，倒是可以建部分单列索引")]),s._v(" "),a("p",[a("code",[s._v("create index index_tables_on_fields on tables (field) where length(field) < 500;")])]),s._v(" "),a("p",[s._v("但是没什么卵用，单列索引还是慢，尝试使用插件")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" EXTENSION pg_trgm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" index_tables_on_field "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" gin "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("field gin_trgm_ops"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("依然没什么卵用，看查询计划pg根本不用它。\n没办法最后通过"),a("code",[s._v("elastic search")]),s._v("查出id进行二次查询")]),s._v(" "),a("p",[a("code",[s._v("{ match: { field: value } }")])]),s._v(" "),a("h2",{attrs:{id:"json-field"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#json-field"}},[s._v("#")]),s._v(" json field")]),s._v(" "),a("p",[s._v("涉及表里的json字段搜索，有的枚举值数据分布很集中，单列索引不管用，json字段也放不到复合索引里，最后把这些字段同步到另一个mongo库里，查出id再进行二次查询")]),s._v(" "),a("h2",{attrs:{id:"二次查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二次查询"}},[s._v("#")]),s._v(" 二次查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("analyze")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tables"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tables"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tables"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tables"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tables"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tables"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"field"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tables"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFFSET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n")])])]),a("p",[s._v("这里的(ids)是第一次查询查出来的，本以为二次查询会走index-only scan，事实是当id数量很大的时候查询分析器对于子查询还是选择了"),a("code",[s._v("bitmap heap scan")]),s._v("(又回到最初的起点~😂)，试了一下"),a("code",[s._v("set enable_bitmapscan to off")]),s._v("，居然可以"),a("code",[s._v("index-only scan")]),s._v("了🎉，所以最后在每次查询前先执行这一句。")]),s._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("顶着压力各种hack暂时解决了问题。剑走偏锋，实属无奈之举;正奇相合，方为长久之道。")]),s._v(" "),a("h2",{attrs:{id:"常用sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用sql"}},[s._v("#")]),s._v(" 常用sql")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 连接数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" datname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_stat_activity "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" datname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" c "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 慢查询")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("distinct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" query "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_stat_activity "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" state "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'idle'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" pg_stat_activity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query_start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2s'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 索引列表")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" indexname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" indexdef "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_indexes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" tablename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tables'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 索引大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" pg_relation_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'index_tables_on_field'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 删除索引")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exists")]),s._v(" index_tables_on_field"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 设置参数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" enable_bitmapscan "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- json field创建部分索引")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index_tables_on_field "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jsondoc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'field'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jsondoc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'field'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 创建拓展")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" EXTENSION pg_trgm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看上次vacuum")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" relname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("last_vacuum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" last_autovacuum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" last_analyze"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" last_autoanalyze "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_stat_user_tables "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" relname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tables'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看查询计划")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("analyze")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 锁相关")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_locks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" \n    relname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" relation_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    pg_locks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" pg_locks\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_class "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" pg_locks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relation "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pg_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oid\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" pg_stat_activity "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" pg_locks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pg_stat_activity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://dba.stackexchange.com/questions/196721/bitmap-heapscan-is-slow",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://dba.stackexchange.com/questions/196721/bitmap-heapscan-is-slow"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cybertec-postgresql.com/en/postgresql-indexing-index-scan-vs-bitmap-scan-vs-sequential-scan-basics/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.cybertec-postgresql.com/en/postgresql-indexing-index-scan-vs-bitmap-scan-vs-sequential-scan-basics/"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://pganalyze.com/docs/explain/scan-nodes/bitmap-index-scan",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://pganalyze.com/docs/explain/scan-nodes/bitmap-index-scan"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://stackoverflow.com/questions/3581294/index-key-column-vs-index-included-column",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://stackoverflow.com/questions/3581294/index-key-column-vs-index-included-column"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://use-the-index-luke.com/blog/2019-04/include-columns-in-btree-indexes",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://use-the-index-luke.com/blog/2019-04/include-columns-in-btree-indexes"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.postgresql.org/docs/12/runtime-config-autovacuum.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.postgresql.org/docs/12/runtime-config-autovacuum.html"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.shanelynn.ie/postgresql-find-slow-long-running-and-blocked-queries/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.shanelynn.ie/postgresql-find-slow-long-running-and-blocked-queries/"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://help.aliyun.com/document_detail/281785.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://help.aliyun.com/document_detail/281785.html"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.lob.com/blog/supercharge-your-postgresql-performance",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.lob.com/blog/supercharge-your-postgresql-performance"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://stackoverflow.com/questions/1566717/postgresql-like-query-performance-variations",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://stackoverflow.com/questions/1566717/postgresql-like-query-performance-variations"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://stackoverflow.com/questions/53583257/is-there-a-workaround-to-ensure-index-only-scan-on-jsondoc-equality-que",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://stackoverflow.com/questions/53583257/is-there-a-workaround-to-ensure-index-only-scan-on-jsondoc-equality-que"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);